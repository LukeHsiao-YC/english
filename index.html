<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªå–®å­—å†’éšª RPG - ç©¶æ¥µé€²åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; }
        
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake {
          animation: shake 0.3s ease-in-out;
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
        .animate-heal {
            animation: heal 0.5s ease-out;
        }
        @keyframes heal {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.5) sepia(1) hue-rotate(50deg); } 
            100% { transform: scale(1); filter: brightness(1); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- åœ–ç¤ºçµ„ä»¶ ---
        const Sword = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/></svg>;
        const RefreshCw = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Trophy = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const BookOpen = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const Volume2 = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const Star = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const Puzzle = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19.439 15.424c-1.352 0-2.585-1.079-2.585-2.424 0-1.346 1.233-2.424 2.585-2.424 1.352 0 2.415-1.078 2.415-2.424 0-1.347-1.063-2.424-2.415-2.424h-3.483a2.463 2.463 0 0 0-2.399 1.76l-.428 1.57a1.056 1.056 0 0 1-2.028 0l-.428-1.57A2.463 2.463 0 0 0 7.773 5.728H4.29C2.937 5.728 2 6.805 2 8.152c0 1.346 1.063 2.424 2.415 2.424 1.352 0 2.585 1.078 2.585 2.424 0 1.346-1.233 2.424-2.585 2.424C3.063 15.424 2 16.502 2 17.848c0 1.347 1.063 2.424 2.415 2.424h3.358a2.463 2.463 0 0 0 2.399-1.76l.428-1.57a1.056 1.056 0 0 1 2.028 0l.428 1.57a2.463 2.463 0 0 0 2.399 1.76h3.483c1.352 0 2.415-1.077 2.415-2.424 0-1.346-1.063-2.424-2.415-2.424z"/></svg>;
        const ArrowRight = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>;
        const ArrowLeft = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>;
        const RotateCw = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>;
        const AlertCircle = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
        const Keyboard = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="2" y="4" width="20" height="16" rx="2" ry="2"/><line x1="6" y1="8" x2="6" y2="8"/><line x1="10" y1="8" x2="10" y2="8"/><line x1="14" y1="8" x2="14" y2="8"/><line x1="18" y1="8" x2="18" y2="8"/><line x1="6" y1="12" x2="6" y2="12"/><line x1="10" y1="12" x2="10" y2="12"/><line x1="14" y1="12" x2="14" y2="12"/><line x1="18" y1="12" x2="18" y2="12"/><line x1="6" y1="16" x2="6" y2="16"/><line x1="10" y1="16" x2="14" y2="16"/><line x1="18" y1="16" x2="18" y2="16"/></svg>;

        // --- è³‡æ–™åº«å€ ---
        
        // 1. åŸºç¤å–®å­—åº« (åŒ…å«åŸæœ¬çš„å–®å­—)
        const basicVocabulary = [
          ["zero", "é›¶"], ["one", "ä¸€"], ["two", "äºŒ"], ["three", "ä¸‰"], ["four", "å››"], ["five", "äº”"], ["six", "å…­"], ["seven", "ä¸ƒ"], ["eight", "å…«"], ["nine", "ä¹"], ["ten", "å"],
          ["apple", "è˜‹æœ"], ["banana", "é¦™è•‰"], ["cat", "è²“"], ["dog", "ç‹—"], ["egg", "è›‹"], ["fish", "é­š"], ["girl", "å¥³å­©"], ["hat", "å¸½å­"], ["ice cream", "å†°æ·‡æ·‹"], ["juice", "æœæ±"],
          ["kite", "é¢¨ç®"], ["lion", "ç…å­"], ["monkey", "çŒ´å­"], ["nose", "é¼»å­"], ["orange", "æ©˜å­"], ["pig", "è±¬"], ["queen", "çš‡å"], ["rabbit", "å…”å­"], ["sun", "å¤ªé™½"], ["tiger", "è€è™"],
          ["umbrella", "é›¨å‚˜"], ["van", "ç®±å‹è»Š"], ["watch", "æ‰‹éŒ¶"], ["box", "ç®±å­"], ["yo-yo", "æºœæºœçƒ"], ["zebra", "æ–‘é¦¬"]
        ];

        // 2. æ“´å……å–®å­—åº« (æ•´åˆ Grade 3 - Grade 6)
        // ç‚ºäº†è®“æ‹¼å­—æ¨¡å¼æœ‰ä¸­æ–‡ï¼Œé€™è£¡æ¨¡æ“¬äº†ä¸€å€‹ç°¡å–®çš„å°ç…§è¡¨ã€‚ç”±æ–¼æ•¸é‡é¾å¤§ï¼Œé€™è£¡å±•ç¤ºäº†æ¯å€‹ç´šåˆ¥çš„ç²¾é¸å–®å­—ã€‚
        // åœ¨å¯¦éš›ç”¢å“ä¸­ï¼Œé€™æ‡‰è©²æ˜¯ä¸€å€‹å®Œæ•´çš„ JSON è³‡æ–™åº«ã€‚
        const extendedVocabulary = [
            // Grade 3 (ç²¾é¸)
            ["afternoon", "ä¸‹åˆ"], ["airport", "æ©Ÿå ´"], ["autumn", "ç§‹å¤©"], ["bicycle", "è…³è¸è»Š"], ["blackboard", "é»‘æ¿"], 
            ["breakfast", "æ—©é¤"], ["businessman", "å•†äºº"], ["classroom", "æ•™å®¤"], ["dictionary", "å­—å…¸"], ["dinosaur", "æé¾"],
            ["daughter", "å¥³å…’"], ["December", "åäºŒæœˆ"], ["delicious", "ç¾å‘³çš„"], ["department", "éƒ¨é–€"], ["difference", "å·®ç•°"],
            ["driver", "å¸æ©Ÿ"], ["eleven", "åä¸€"], ["envelope", "ä¿¡å°"], ["evening", "å‚æ™š"], ["exercise", "é‹å‹•/ç·´ç¿’"],
            ["expensive", "æ˜‚è²´çš„"], ["family", "å®¶åº­"], ["farmer", "è¾²å¤«"], ["February", "äºŒæœˆ"], ["fifteen", "åäº”"],
            ["fisherman", "æ¼å¤«"], ["flower", "èŠ±"], ["foreigner", "å¤–åœ‹äºº"], ["Friday", "æ˜ŸæœŸäº”"], ["friend", "æœ‹å‹"],
            ["grandfather", "ç¥–çˆ¶"], ["grandmother", "ç¥–æ¯"], ["hamburger", "æ¼¢å ¡"], ["history", "æ­·å²"], ["homework", "åŠŸèª²"],
            ["hospital", "é†«é™¢"], ["hundred", "ä¸€ç™¾"], ["husband", "ä¸ˆå¤«"], ["island", "å³¶å¶¼"], ["January", "ä¸€æœˆ"],
            ["kitchen", "å»šæˆ¿"], ["library", "åœ–æ›¸é¤¨"], ["machine", "æ©Ÿå™¨"], ["medicine", "è—¥"], ["morning", "æ—©ä¸Š"],
            ["mountain", "å±±"], ["museum", "åšç‰©é¤¨"], ["musician", "éŸ³æ¨‚å®¶"], ["neighbor", "é„°å±…"], ["newspaper", "å ±ç´™"],
            ["notebook", "ç­†è¨˜æœ¬"], ["November", "åä¸€æœˆ"], ["October", "åæœˆ"], ["office", "è¾¦å…¬å®¤"], ["parent", "çˆ¶æ¯"],
            ["picnic", "é‡é¤"], ["picture", "åœ–ç‰‡"], ["playground", "æ“å ´"], ["police", "è­¦å¯Ÿ"], ["problem", "å•é¡Œ"],
            ["question", "å•é¡Œ"], ["rainbow", "å½©è™¹"], ["restaurant", "é¤å»³"], ["sandwich", "ä¸‰æ˜æ²»"], ["Saturday", "æ˜ŸæœŸå…­"],
            ["science", "ç§‘å­¸"], ["season", "å­£ç¯€"], ["September", "ä¹æœˆ"], ["shoulder", "è‚©è†€"], ["sidewalk", "äººè¡Œé“"],
            ["soldier", "å£«å…µ"], ["stomach", "èƒƒ"], ["strawberry", "è‰è“"], ["student", "å­¸ç”Ÿ"], ["summer", "å¤å¤©"],
            ["Sunday", "æ˜ŸæœŸæ—¥"], ["supermarket", "è¶…å¸‚"], ["surprise", "é©šå–œ"], ["sweater", "æ¯›è¡£"], ["teacher", "è€å¸«"],
            ["telephone", "é›»è©±"], ["television", "é›»è¦–"], ["theater", "é›»å½±é™¢"], ["thirteen", "åä¸‰"], ["thousand", "ä¸€åƒ"],
            ["Thursday", "æ˜ŸæœŸå››"], ["ticket", "ç¥¨"], ["tomorrow", "æ˜å¤©"], ["traffic", "äº¤é€š"], ["Tuesday", "æ˜ŸæœŸäºŒ"],
            ["umbrella", "é›¨å‚˜"], ["uniform", "åˆ¶æœ"], ["vacation", "å‡æœŸ"], ["vegetable", "è”¬èœ"], ["weather", "å¤©æ°£"],
            ["Wednesday", "æ˜ŸæœŸä¸‰"], ["weekend", "é€±æœ«"], ["winter", "å†¬å¤©"], ["wonderful", "ç¾å¥½çš„"], ["yesterday", "æ˜¨å¤©"],
            // Grade 4 (ç²¾é¸)
            ["apartment", "å…¬å¯“"], ["balcony", "é™½å°"], ["badminton", "ç¾½æ¯›çƒ"], ["bakery", "éºµåŒ…åº—"], ["balloon", "æ°£çƒ"],
            ["basement", "åœ°ä¸‹å®¤"], ["bathroom", "æµ´å®¤"], ["beautiful", "ç¾éº—çš„"], ["bedroom", "è‡¥å®¤"], ["birthday", "ç”Ÿæ—¥"],
            ["blanket", "æ¯¯å­"], ["bookstore", "æ›¸åº—"], ["bracelet", "æ‰‹éŠ"], ["building", "å»ºç¯‰ç‰©"], ["butterfly", "è´è¶"],
            ["cabbage", "é«˜éº—èœ"], ["cafeteria", "è‡ªåŠ©é¤å»³"], ["calendar", "æ—¥æ›†"], ["camera", "ç›¸æ©Ÿ"], ["captain", "éšŠé•·"],
            ["careful", "å°å¿ƒçš„"], ["cartoon", "å¡é€š"], ["celebrate", "æ…¶ç¥"], ["cellphone", "æ‰‹æ©Ÿ"], ["century", "ä¸–ç´€"],
            ["chemistry", "åŒ–å­¸"], ["chocolate", "å·§å…‹åŠ›"], ["chopsticks", "ç­·å­"], ["Christmas", "è–èª•ç¯€"], ["classmate", "åŒå­¸"],
            ["comfortable", "èˆ’é©çš„"], ["computer", "é›»è…¦"], ["confident", "æœ‰è‡ªä¿¡çš„"], ["convenient", "æ–¹ä¾¿çš„"], ["conversation", "å°è©±"],
            ["dangerous", "å±éšªçš„"], ["daughter", "å¥³å…’"], ["decision", "æ±ºå®š"], ["dentist", "ç‰™é†«"], ["different", "ä¸åŒçš„"],
            ["difficult", "å›°é›£çš„"], ["direction", "æ–¹å‘"], ["discount", "æŠ˜æ‰£"], ["discover", "ç™¼ç¾"], ["discuss", "è¨è«–"],
            ["dolphin", "æµ·è±š"], ["doughnut", "ç”œç”œåœˆ"], ["downstairs", "æ¨“ä¸‹"], ["dumpling", "æ°´é¤ƒ"], ["earthquake", "åœ°éœ‡"],
            ["education", "æ•™è‚²"], ["elephant", "å¤§è±¡"], ["elevator", "é›»æ¢¯"], ["engineer", "å·¥ç¨‹å¸«"], ["entrance", "å…¥å£"],
            ["envelope", "ä¿¡å°"], ["environment", "ç’°å¢ƒ"], ["especially", "ç‰¹åˆ¥æ˜¯"], ["everybody", "æ¯å€‹äºº"], ["everything", "æ¯ä»¶äº‹"],
            ["excellent", "å„ªç§€çš„"], ["exciting", "ä»¤äººèˆˆå¥®çš„"], ["experience", "ç¶“é©—"], ["factory", "å·¥å» "], ["fantastic", "æ¥µå¥½çš„"],
            ["fashionable", "æ™‚å°šçš„"], ["favorite", "æœ€å–œæ„›çš„"], ["festival", "ç¯€æ—¥"], ["finish", "å®Œæˆ"], ["foreigner", "å¤–åœ‹äºº"],
            ["furniture", "å‚¢ä¿±"], ["gentleman", "ç´³å£«"], ["geography", "åœ°ç†"], ["government", "æ”¿åºœ"], ["grandson", "å­«å­"],
            ["handsome", "è‹±ä¿Šçš„"], ["helicopter", "ç›´å‡æ©Ÿ"], ["holiday", "å‡æ—¥"], ["homework", "ä½œæ¥­"], ["horrible", "å¯æ€•çš„"],
            // Grade 5 & 6 words
            ["information", "è³‡è¨Š"], ["instrument", "æ¨‚å™¨"], ["intelligent", "è°æ˜çš„"], ["interest", "èˆˆè¶£"], ["international", "åœ‹éš›çš„"],
            ["interrupt", "æ‰“æ–·"], ["introduce", "ä»‹ç´¹"], ["invention", "ç™¼æ˜"], ["invitation", "é‚€è«‹"], ["journalist", "è¨˜è€…"],
            ["kangaroo", "è¢‹é¼ "], ["kindergarten", "å¹¼ç¨šåœ’"], ["knowledge", "çŸ¥è­˜"], ["language", "èªè¨€"], ["lemonade", "æª¸æª¬æ°´"],
            ["magazine", "é›œèªŒ"], ["magician", "é­”è¡“å¸«"], ["manager", "ç¶“ç†"], ["marvelous", "éå‡¡çš„"], ["mathematics", "æ•¸å­¸"],
            ["mechanic", "æŠ€å·¥"], ["medicine", "è—¥ç‰©"], ["microphone", "éº¥å…‹é¢¨"], ["microwave", "å¾®æ³¢çˆ"], ["midnight", "åˆå¤œ"],
            ["mosquito", "èšŠå­"], ["motorcycle", "æ‘©æ‰˜è»Š"], ["mountain", "å±±è„ˆ"], ["musician", "éŸ³æ¨‚å®¶"], ["necklace", "é …éŠ"],
            ["neighbor", "é„°å±…"], ["newspaper", "å ±ç´™"], ["nightmare", "æƒ¡å¤¢"], ["notebook", "ç­†è¨˜æœ¬"], ["november", "åä¸€æœˆ"],
            ["operation", "æ‰‹è¡“/æ“ä½œ"], ["ordinary", "æ™®é€šçš„"], ["overseas", "æµ·å¤–çš„"], ["painting", "ç¹ªç•«"], ["pajamas", "ç¡è¡£"],
            ["passenger", "ä¹˜å®¢"], ["passport", "è­·ç…§"], ["photograph", "ç…§ç‰‡"], ["platform", "æœˆå°"], ["pleasant", "æ„‰å¿«çš„"],
            ["pollution", "æ±¡æŸ“"], ["population", "äººå£"], ["position", "ä½ç½®"], ["positive", "æ­£é¢çš„"], ["postcard", "æ˜ä¿¡ç‰‡"],
            ["potato", "é¦¬éˆ´è–¯"], ["precious", "çè²´çš„"], ["president", "ç¸½çµ±"], ["pressure", "å£“åŠ›"], ["princess", "å…¬ä¸»"],
            ["principal", "æ ¡é•·"], ["principle", "åŸå‰‡"], ["problem", "å•é¡Œ"], ["professor", "æ•™æˆ"], ["program", "ç¯€ç›®/ç¨‹å¼"],
            ["pronounce", "ç™¼éŸ³"], ["protect", "ä¿è­·"], ["pumpkin", "å—ç“œ"], ["question", "å•é¡Œ"], ["railroad", "éµè·¯"],
            ["raincoat", "é›¨è¡£"], ["rectangle", "é•·æ–¹å½¢"], ["refrigerator", "å†°ç®±"], ["remember", "è¨˜å¾—"], ["reporter", "è¨˜è€…"],
            ["restaurant", "é¤å»³"], ["restroom", "æ´—æ‰‹é–“"], ["sandwich", "ä¸‰æ˜æ²»"], ["Saturday", "æ˜ŸæœŸå…­"], ["scenery", "é¢¨æ™¯"],
            ["schedule", "è¡Œç¨‹è¡¨"], ["science", "ç§‘å­¸"], ["scientist", "ç§‘å­¸å®¶"], ["scooter", "æ©Ÿè»Š"], ["secretary", "ç§˜æ›¸"]
        ];

        // åˆä½µè³‡æ–™åº«
        const combinedVocab = [...basicVocabulary, ...extendedVocabulary];

        const generateWordDatabase = () => {
          return combinedVocab.map((item, index) => ({
            id: index + 1,
            word: item[0],
            meaning: item[1],
            example: `Question: What is the meaning of '${item[0]}'?`
          }));
        };

        const battleDatabase = generateWordDatabase();

        const monsterAvatars = [
          'ğŸ‘¾', 'ğŸŒ', 'ğŸ', 'ğŸ•·ï¸', 'ğŸ¦‡', 'ğŸº', 'ğŸ‘»', 'ğŸ¦', 'ğŸ‘¹', 'ğŸ²'
        ];

        function App() {
          const [gameState, setGameState] = useState('menu'); // menu, playing_battle, playing_fill, playing_typing_setup, playing_typing, learning, gameover, victory
          const [gameMode, setGameMode] = useState('battle'); 
          const [typingDifficulty, setTypingDifficulty] = useState(null); // 'easy', 'medium', 'hard'
          
          const [playerHp, setPlayerHp] = useState(100);
          const [maxPlayerHp] = useState(100);
          const [score, setScore] = useState(0);
          const [combo, setCombo] = useState(0);
          
          const [monsterHp, setMonsterHp] = useState(100);
          const [maxMonsterHp] = useState(100);
          const [currentMonsterLevel, setCurrentMonsterLevel] = useState(1);
          
          const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
          const [shuffledQuestions, setShuffledQuestions] = useState([]);
          
          const [currentFillQuestion, setCurrentFillQuestion] = useState(null);
          const [currentTypingQuestion, setCurrentTypingQuestion] = useState(null); 
          
          const [currentOptions, setCurrentOptions] = useState([]);
          const [selectedOption, setSelectedOption] = useState(null);
          const [feedback, setFeedback] = useState(null);
          const [showExplanation, setShowExplanation] = useState(false);
          const [typingInput, setTypingInput] = useState('');

          const [isFlipped, setIsFlipped] = useState(false);
          const [isPlayerAttacking, setIsPlayerAttacking] = useState(false);
          const [isMonsterAttacking, setIsMonsterAttacking] = useState(false);
          const [monsterHealed, setMonsterHealed] = useState(false);
          const [shake, setShake] = useState(false);

          // è¨˜éŒ„éŒ¯èª¤é¡Œç›® { q: "apple", a: "apple (è˜‹æœ)" }
          const [wrongAnswers, setWrongAnswers] = useState([]);

          const inputRef = useRef(null);

          // åˆå§‹åŒ–é—œå¡
          useEffect(() => {
            if (gameState === 'playing_battle' || gameState === 'playing_fill' || gameState === 'playing_typing') {
              const questions = [...battleDatabase].sort(() => Math.random() - 0.5);
              
              setShuffledQuestions(questions);
              setCurrentQuestionIndex(0);
              setPlayerHp(maxPlayerHp);
              setMonsterHp(maxMonsterHp);
              setScore(0);
              setCombo(0);
              setCurrentMonsterLevel(1);
              setFeedback(null);
              setShowExplanation(false);
              setWrongAnswers([]); 
              
              if (questions.length > 0) {
                const firstQ = questions[0];
                if (gameState === 'playing_fill') {
                   setCurrentFillQuestion(generateFillQuestion(firstQ));
                } else if (gameState === 'playing_typing') {
                   setCurrentTypingQuestion(generateTypingQuestion(firstQ, typingDifficulty));
                } else {
                   setCurrentOptions(generateBattleOptions(firstQ, battleDatabase));
                }
              }

            } else if (gameState === 'learning') {
               setCurrentQuestionIndex(0);
               setIsFlipped(false);
            }
          }, [gameState, typingDifficulty]);

          // è‡ªå‹•èšç„¦è¼¸å…¥æ¡†
          useEffect(() => {
              if (gameState === 'playing_typing' && !showExplanation && inputRef.current) {
                  inputRef.current.focus();
              }
          }, [gameState, showExplanation, currentQuestionIndex]);

          const speakWord = (text) => {
            if ('speechSynthesis' in window) {
              window.speechSynthesis.cancel();
              const utterance = new SpeechSynthesisUtterance(text);
              utterance.lang = 'en-US';
              utterance.rate = 0.8;
              window.speechSynthesis.speak(utterance);
            }
          };

          const generateBattleOptions = (correctWordData, allWords) => {
            const correctMeaning = correctWordData.meaning;
            const wrongOptions = [];
            const usedIndices = new Set([correctWordData.id]);
            
            while (wrongOptions.length < 3) {
              const randomIndex = Math.floor(Math.random() * allWords.length);
              const randomWord = allWords[randomIndex];
              
              if (!usedIndices.has(randomWord.id) && randomWord.meaning !== correctMeaning) {
                wrongOptions.push(randomWord.meaning);
                usedIndices.add(randomWord.id);
              }
            }
            return [...wrongOptions, correctMeaning].sort(() => Math.random() - 0.5);
          };

          const generateFillQuestion = (wordData) => {
            const word = wordData.word;
            const indices = word.split('').map((c, i) => i).filter(i => /[a-zA-Z]/.test(word[i]));
            
            if (indices.length === 0) return { ...wordData, maskedWord: word, targetChar: '', fillOptions: [] };

            const targetIndex = indices[Math.floor(Math.random() * indices.length)];
            const targetChar = word[targetIndex].toLowerCase(); 
            
            const maskedWord = word.substring(0, targetIndex) + '_' + word.substring(targetIndex + 1);
            
            const alphabet = 'abcdefghijklmnopqrstuvwxyz';
            let options = [targetChar];
            while(options.length < 4) {
              const char = alphabet[Math.floor(Math.random() * alphabet.length)];
              if (!options.includes(char)) options.push(char);
            }
            
            return {
              ...wordData,
              maskedWord,
              targetChar,
              fillOptions: options.sort(() => Math.random() - 0.5)
            };
          };

          // æ ¸å¿ƒï¼šç”Ÿæˆæ‹¼å­—é¡Œç›® (ä¾é›£åº¦)
          const generateTypingQuestion = (wordData, difficulty) => {
            const word = wordData.word;
            const chars = word.split('');
            const validIndices = chars.map((c, i) => /[a-zA-Z]/.test(c) ? i : -1).filter(i => i !== -1);
            
            let maskedIndices = new Set();

            if (validIndices.length <= 1) {
                // å–®å­—å¤ªçŸ­ï¼Œä¸æŒ–ç©ºæˆ–å…¨æŒ–
                return { ...wordData, maskedDisplay: word };
            }

            if (difficulty === 'hard') {
                // å›°é›£ï¼šåªç•™é ­å°¾ï¼Œä¸­é–“å…¨æŒ–
                for (let i = 1; i < chars.length - 1; i++) {
                    if (/[a-zA-Z]/.test(chars[i])) maskedIndices.add(i);
                }
            } else if (difficulty === 'medium') {
                // ä¸­ç­‰ï¼šéš¨æ©ŸæŒ– 2 å€‹ (å¦‚æœé•·åº¦å¤ )
                const count = Math.min(2, validIndices.length);
                while(maskedIndices.size < count) {
                    const idx = validIndices[Math.floor(Math.random() * validIndices.length)];
                    maskedIndices.add(idx);
                }
            } else {
                // ç°¡å–®ï¼šéš¨æ©ŸæŒ– 1 å€‹
                const idx = validIndices[Math.floor(Math.random() * validIndices.length)];
                maskedIndices.add(idx);
            }
            
            const maskedDisplay = chars.map((c, i) => maskedIndices.has(i) ? '_' : c).join(' ');
            return {
                ...wordData,
                maskedDisplay
            };
          };

          const handleTypingSubmit = (e) => {
              e.preventDefault();
              if (feedback !== null) return;
              
              const userAnswer = typingInput.trim().toLowerCase();
              const correctAnswer = currentTypingQuestion.word.toLowerCase();
              
              if (userAnswer === correctAnswer) {
                  processResult(true);
              } else {
                  processResult(false);
              }
              setTypingInput('');
          };

          const handleAnswer = (option) => {
            if (feedback !== null) return;
            setSelectedOption(option);
            
            let isCorrect = false;
            const currentQ = shuffledQuestions[currentQuestionIndex];
            
            if (gameState === 'playing_battle') {
              isCorrect = option === currentQ.meaning;
            } else if (gameState === 'playing_fill') {
              isCorrect = option === currentFillQuestion.targetChar;
            }

            processResult(isCorrect);
          };

          // çµ±ä¸€è™•ç†çµæœ (åŒ…å«æ€ªç¸å›è¡€é‚è¼¯)
          const processResult = (isCorrect) => {
              const currentQ = shuffledQuestions[currentQuestionIndex];
              // è¨˜éŒ„éŒ¯èª¤
              const questionRecord = { q: currentQ.word, a: `${currentQ.word} (${currentQ.meaning})` };

              if (isCorrect) {
                  setFeedback('correct');
                  setCombo(prev => prev + 1);
                  setScore(prev => prev + (100 + (combo * 10)));
                  
                  setIsPlayerAttacking(true);
                  setTimeout(() => setIsPlayerAttacking(false), 500);
                  
                  const damage = 20 + (combo * 2);
                  setMonsterHp(prev => Math.max(0, prev - damage));

                  setTimeout(() => {
                    if (monsterHp - damage <= 0) {
                      handleMonsterDefeated();
                    } else {
                      nextQuestion();
                    }
                  }, 1200);

              } else {
                  setFeedback('wrong');
                  setCombo(0);
                  setShake(true);
                  
                  setWrongAnswers(prev => [...prev, questionRecord]);

                  setTimeout(() => setShake(false), 500);

                  setIsMonsterAttacking(true);
                  setTimeout(() => setIsMonsterAttacking(false), 500);
                  
                  // ç©å®¶æ‰£è¡€
                  const damage = 25;
                  setPlayerHp(prev => Math.max(0, prev - damage));

                  // æ€ªç¸å›è¡€ (å¸è¡€æ©Ÿåˆ¶)
                  const healAmount = 15;
                  setMonsterHealed(true);
                  setMonsterHp(prev => Math.min(maxMonsterHp, prev + healAmount));
                  setTimeout(() => setMonsterHealed(false), 500);
                  
                  setShowExplanation(true);
              }
          };

          const handleMonsterDefeated = () => {
            if (currentMonsterLevel >= monsterAvatars.length) {
              setGameState('victory');
            } else {
              setCurrentMonsterLevel(prev => prev + 1);
              setMonsterHp(maxMonsterHp + (currentMonsterLevel * 50));
              setPlayerHp(prev => Math.min(maxPlayerHp, prev + 30));
              nextQuestion();
            }
          };

          const nextQuestion = () => {
            setFeedback(null);
            setSelectedOption(null);
            setShowExplanation(false);
            setTypingInput('');
            
            let nextIndex = currentQuestionIndex;
            let nextQuestions = shuffledQuestions;

            if (currentQuestionIndex < shuffledQuestions.length - 1) {
              nextIndex = currentQuestionIndex + 1;
              setCurrentQuestionIndex(prev => prev + 1);
            } else {
              let newQuestions = [...battleDatabase].sort(() => Math.random() - 0.5);
              setShuffledQuestions(newQuestions);
              nextQuestions = newQuestions;
              setCurrentQuestionIndex(0);
              nextIndex = 0;
            }
            
            const nextQ = nextQuestions[nextIndex];
            if (gameState === 'playing_fill') {
              setCurrentFillQuestion(generateFillQuestion(nextQ));
            } else if (gameState === 'playing_typing') {
              setCurrentTypingQuestion(generateTypingQuestion(nextQ, typingDifficulty));
            } else {
              setCurrentOptions(generateBattleOptions(nextQ, battleDatabase));
            }
            
            if (playerHp <= 0) {
              setGameState('gameover');
            }
          };

          const handleLearningNav = (direction) => {
            setIsFlipped(false);
            if (direction === 'next') {
                setCurrentQuestionIndex(prev => (prev + 1) % battleDatabase.length);
            } else {
                setCurrentQuestionIndex(prev => (prev - 1 + battleDatabase.length) % battleDatabase.length);
            }
          };

          const HealthBar = ({ current, max, color, label }) => (
            <div className="w-full">
              <div className="flex justify-between text-xs font-bold mb-1 text-slate-600">
                <span>{label}</span>
                <span>{Math.ceil(current)} / {max}</span>
              </div>
              <div className="h-4 bg-slate-200 rounded-full overflow-hidden border border-slate-300 relative">
                <div 
                  className={`h-full transition-all duration-500 ease-out ${color}`}
                  style={{ width: `${(Math.max(0, current) / max) * 100}%` }}
                ></div>
              </div>
            </div>
          );

          // éŒ¯èª¤å›é¡§çµ„ä»¶
          const ReviewSection = () => (
             wrongAnswers.length > 0 ? (
                <div className="mt-6 w-full text-left bg-red-50 p-4 rounded-xl border border-red-100 max-h-60 overflow-y-auto">
                    <h3 className="font-bold text-red-600 mb-2 flex items-center gap-2">
                        <AlertCircle className="w-4 h-4" /> éŒ¯é¡Œè¤‡ç¿’ (Mistakes)
                    </h3>
                    <ul className="space-y-2">
                        {wrongAnswers.map((item, idx) => (
                            <li key={idx} className="text-sm border-b border-red-100 last:border-0 pb-1">
                                <span className="font-bold text-slate-700">{item.q}</span>
                                <br/>
                                <span className="text-green-600">Ans: {item.a}</span>
                            </li>
                        ))}
                    </ul>
                </div>
             ) : (
                 <div className="mt-6 text-green-600 font-bold bg-green-50 p-4 rounded-xl">
                    å®Œç¾è¡¨ç¾ï¼æ²’æœ‰ç­”éŒ¯ä»»ä½•é¡Œç›®ï¼
                 </div>
             )
          );

          // é›£åº¦é¸æ“‡ç•«é¢
          if (gameState === 'playing_typing_setup') {
              return (
                <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4 font-sans text-slate-800">
                    <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center border-b-4 border-red-200">
                        <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <Keyboard className="w-10 h-10 text-red-600" />
                        </div>
                        <h2 className="text-2xl font-bold mb-6">é¸æ“‡æ‹¼å­—é›£åº¦</h2>
                        <div className="space-y-3">
                            <button onClick={() => { setTypingDifficulty('easy'); setGameState('playing_typing'); }} className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl">
                                ç°¡å–® (ç©º 1 æ ¼)
                            </button>
                            <button onClick={() => { setTypingDifficulty('medium'); setGameState('playing_typing'); }} className="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 rounded-xl">
                                ä¸­ç­‰ (ç©º 2 æ ¼)
                            </button>
                            <button onClick={() => { setTypingDifficulty('hard'); setGameState('playing_typing'); }} className="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl">
                                å›°é›£ (åƒ…é ­å°¾)
                            </button>
                            <button onClick={() => setGameState('menu')} className="w-full text-slate-400 font-bold py-3 mt-4">
                                è¿”å›ä¸»é¸å–®
                            </button>
                        </div>
                    </div>
                </div>
              );
          }

          if (gameState === 'menu') {
            return (
              <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4 font-sans text-slate-800">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center border-b-4 border-indigo-200">
                  <div className="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <Sword className="w-10 h-10 text-indigo-600" />
                  </div>
                  <h1 className="text-3xl font-bold text-slate-800 mb-2">è‹±èªå–®å­—å¤§å†’éšª</h1>
                  <p className="text-slate-500 mb-2">ç©¶æ¥µé€²åŒ–ç‰ˆï¼šæ”¶éŒ„åœ‹å°3-6å¹´ç´šå–®å­—ï¼</p>
                  
                  <div className="space-y-4">
                    <button 
                      onClick={() => { setGameState('playing_battle'); setGameMode('battle'); }}
                      className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-3"
                    >
                      <Sword className="w-5 h-5" />
                      å–®å­—å°æ±º (Battle)
                    </button>
                    
                    <button 
                      onClick={() => { setGameState('playing_fill'); setGameMode('fill'); }}
                      className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-3"
                    >
                      <Puzzle className="w-5 h-5" />
                      ç¬¦æ–‡å¡«ç©º (Select)
                    </button>

                    <button 
                      onClick={() => { setGameMode('typing'); setGameState('playing_typing_setup'); }}
                      className="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-3 border-b-4 border-red-700"
                    >
                      <Keyboard className="w-5 h-5" />
                      æ¥µé™æ‹¼å­— (Typing)
                    </button>
                    
                    <button 
                      onClick={() => setGameState('learning')}
                      className="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-md flex items-center justify-center gap-3"
                    >
                      <BookOpen className="w-5 h-5" />
                      è¨˜æ†¶æ®¿å ‚ (Learning)
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          if (gameState === 'learning') {
            const currentWord = battleDatabase[currentQuestionIndex];
            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center justify-center p-4 font-sans">
                     <header className="absolute top-4 left-4 right-4 flex justify-between items-center">
                        <button onClick={() => setGameState('menu')} className="p-2 bg-white rounded-full shadow-sm text-slate-500 hover:bg-slate-50">
                            <ArrowLeft className="w-6 h-6" />
                        </button>
                        <h2 className="font-bold text-slate-700 text-lg flex items-center gap-2">
                            <BookOpen className="w-5 h-5" /> è¨˜æ†¶æ®¿å ‚
                        </h2>
                        <div className="w-10"></div>
                    </header>

                    <div className="perspective-1000 w-full max-w-sm h-96 cursor-pointer group" onClick={() => setIsFlipped(!isFlipped)}>
                        <div className={`relative w-full h-full transition-all duration-500 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                            <div className="absolute w-full h-full backface-hidden bg-white rounded-2xl shadow-xl flex flex-col items-center justify-center border-b-4 border-indigo-200 p-8">
                                <span className="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-4">Word Card</span>
                                <h2 className="text-4xl font-black text-slate-800 mb-4 text-center break-words w-full">{currentWord.word}</h2>
                                <button 
                                   onClick={(e) => {
                                     e.stopPropagation();
                                     speakWord(currentWord.word);
                                   }}
                                   className="bg-indigo-100 hover:bg-indigo-200 p-3 rounded-full text-indigo-600 transition-colors mb-4"
                                >
                                    <Volume2 className="w-6 h-6" />
                                </button>
                                <p className="mt-4 text-slate-400 text-sm flex items-center gap-1">
                                    <RotateCw className="w-3 h-3" /> é»æ“Šç¿»è½‰æŸ¥çœ‹æ„æ€
                                </p>
                            </div>
                            <div className="absolute w-full h-full backface-hidden bg-indigo-600 rounded-2xl shadow-xl flex flex-col items-center justify-center rotate-y-180 p-8 text-white border-b-4 border-indigo-800">
                                <h3 className="text-3xl font-bold mb-4 text-center">{currentWord.meaning}</h3>
                                <div className="w-full h-px bg-indigo-500 mb-4"></div>
                                <div className="text-left w-full bg-indigo-700/50 p-4 rounded-lg">
                                    <p className="text-indigo-200 text-xs font-bold uppercase mb-2">Practice</p>
                                    <p className="italic text-lg leading-relaxed">{currentWord.example}</p>
                                </div>
                                 <p className="mt-8 text-indigo-300 text-sm flex items-center gap-1">
                                    <RotateCw className="w-3 h-3" /> é»æ“Šç¿»è½‰å›å–®å­—
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="flex items-center gap-6 mt-8">
                        <button onClick={(e) => {e.stopPropagation(); handleLearningNav('prev')}} className="p-4 bg-white rounded-full shadow-lg text-slate-700 hover:bg-indigo-50 transition-colors">
                            <ArrowLeft className="w-6 h-6" />
                        </button>
                         <span className="font-bold text-slate-400">
                            {currentQuestionIndex + 1} / {battleDatabase.length}
                        </span>
                        <button onClick={(e) => {e.stopPropagation(); handleLearningNav('next')}} className="p-4 bg-white rounded-full shadow-lg text-slate-700 hover:bg-indigo-50 transition-colors">
                            <ArrowRight className="w-6 h-6" />
                        </button>
                    </div>
                </div>
            )
          }

          if (gameState === 'gameover' || gameState === 'victory') {
            return (
              <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4 font-sans">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center border-b-4 border-slate-200">
                  <div className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 ${gameState === 'victory' ? 'bg-yellow-100' : 'bg-slate-100'}`}>
                    {gameState === 'victory' ? (
                      <Trophy className="w-10 h-10 text-yellow-500" />
                    ) : (
                      <RefreshCw className="w-10 h-10 text-slate-500" />
                    )}
                  </div>
                  <h2 className="text-2xl font-bold mb-2">
                    {gameState === 'victory' ? 'å‚³èªªé”æˆï¼' : 'å†æ¥å†å²ï¼'}
                  </h2>
                  <p className="text-slate-500 mb-2">
                    æœ€çµ‚åˆ†æ•¸: <span className="font-bold text-indigo-600 text-xl">{score}</span>
                  </p>

                  <ReviewSection />

                  <button 
                    onClick={() => setGameState('menu')}
                    className="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-6 rounded-xl transition-all mt-6"
                  >
                    å›åˆ°ä¸»é¸å–®
                  </button>
                </div>
              </div>
            );
          }

          const currentQ = shuffledQuestions[currentQuestionIndex];
          if (!currentQ) return <div className="min-h-screen flex items-center justify-center">Loading Data...</div>;

          return (
            <div className={`min-h-screen bg-slate-50 flex flex-col p-4 font-sans overflow-hidden ${shake ? 'animate-shake' : ''}`}>
              <header className="max-w-xl mx-auto w-full mb-6 flex justify-between items-center bg-white p-3 rounded-xl shadow-sm border border-slate-100">
                <div className="flex items-center gap-2">
                  <Star className="w-5 h-5 text-yellow-500 fill-current" />
                  <span className="font-bold text-slate-700">{score}</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-xs font-bold text-slate-400">COMBO</span>
                  <span className={`font-black text-xl ${combo > 2 ? 'text-orange-500' : 'text-slate-300'}`}>{combo}</span>
                </div>
                <button onClick={() => setGameState('menu')} className="p-2 hover:bg-slate-100 rounded-lg text-slate-400">
                  <RefreshCw className="w-4 h-4" />
                </button>
              </header>

              <div className="flex-1 max-w-xl mx-auto w-full flex flex-col gap-6">
                <div className="bg-gradient-to-b from-indigo-50 to-white rounded-2xl p-6 shadow-md border border-indigo-100 relative min-h-[200px] flex items-end justify-between">
                    <div className={`flex flex-col items-center transition-transform duration-200 ${isMonsterAttacking ? '-translate-x-10 scale-110' : ''} ${feedback === 'correct' ? 'opacity-50 scale-90 filter grayscale' : ''} ${monsterHealed ? 'animate-heal' : ''}`}>
                        <div className="text-6xl mb-2 transition-all transform duration-300">
                            {monsterAvatars[(currentMonsterLevel - 1) % monsterAvatars.length]}
                        </div>
                        {monsterHealed && <div className="absolute -top-10 text-green-500 font-bold text-lg animate-bounce">+HP Heal!</div>}
                        <div className="w-24">
                           <HealthBar current={monsterHp} max={maxMonsterHp} color="bg-red-500" label={`Lv.${currentMonsterLevel}`} /> 
                        </div>
                    </div>

                    <div className={`flex flex-col items-center transition-transform duration-100 ${isPlayerAttacking ? 'translate-x-10 -translate-y-5 scale-110' : ''} ${feedback === 'wrong' ? 'opacity-50' : ''}`}>
                        <div className="text-6xl mb-2">ğŸ¦¸</div>
                         <div className="w-24">
                           <HealthBar current={playerHp} max={maxPlayerHp} color="bg-green-500" label="Hero" /> 
                        </div>
                    </div>

                    {isPlayerAttacking && <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl animate-ping">ğŸ’¥</div>}
                    {isMonsterAttacking && <div className="absolute bottom-10 right-1/3 text-4xl animate-bounce">ğŸ”¥</div>}
                </div>

                <div className="bg-white rounded-2xl shadow-lg border-b-4 border-indigo-100 p-6 text-center relative overflow-hidden">
                  <div className="absolute top-0 left-0 w-full h-1 bg-indigo-500"></div>
                  
                  {/* æˆ°é¬¥æ¨¡å¼ï¼šé¡¯ç¤ºè‹±æ–‡å–®å­— */}
                  {gameState === 'playing_battle' && (
                      <h2 className="text-4xl font-black text-slate-800 mb-6 break-words">{currentQ.word}</h2>
                  )}

                  {/* å¡«ç©ºæ¨¡å¼ï¼šé¡¯ç¤ºæŒ–ç©ºå–®å­—èˆ‡ä¸­æ–‡æç¤º */}
                  {gameState === 'playing_fill' && (
                      <div className="mb-6">
                        <div className="text-sm font-bold text-slate-400 mb-2 uppercase tracking-wide">Missing Rune</div>
                        <h2 className="text-4xl font-black text-slate-800 tracking-widest font-mono break-words mb-2">
                            {currentFillQuestion ? currentFillQuestion.maskedWord : ''}
                        </h2>
                        
                        <button
                           onClick={() => speakWord(currentQ.word)}
                           className="mx-auto mb-4 flex items-center gap-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-4 py-2 rounded-full transition-colors"
                        >
                            <Volume2 className="w-5 h-5" />
                            <span className="text-sm font-bold">è½ç™¼éŸ³ (Listen)</span>
                        </button>

                        <p className="text-slate-500 text-sm mt-2 font-bold">{currentQ.meaning}</p>
                      </div>
                  )}

                  {/* æ¥µé™æ‹¼å­—æ¨¡å¼ï¼šé¡¯ç¤ºæŒ–ç©ºã€ä¸­æ–‡ã€ç™¼éŸ³ */}
                  {gameState === 'playing_typing' && (
                      <div className="mb-6">
                        <div className="text-sm font-bold text-slate-400 mb-2 uppercase tracking-wide">Typing Challenge ({typingDifficulty})</div>
                        <h2 className="text-4xl font-black text-slate-800 tracking-widest font-mono break-words mb-4">
                            {currentTypingQuestion ? currentTypingQuestion.maskedDisplay : ''}
                        </h2>
                        
                        <div className="flex justify-center items-center gap-4 mb-4">
                            <button
                               onClick={() => speakWord(currentQ.word)}
                               className="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 p-3 rounded-full transition-colors"
                            >
                                <Volume2 className="w-6 h-6" />
                            </button>
                            <p className="text-xl font-bold text-slate-700">{currentQ.meaning}</p>
                        </div>

                        {!showExplanation && (
                            <form onSubmit={handleTypingSubmit} className="flex gap-2 justify-center max-w-sm mx-auto">
                                <input 
                                    ref={inputRef}
                                    type="text" 
                                    value={typingInput}
                                    onChange={(e) => setTypingInput(e.target.value)}
                                    className="border-2 border-indigo-200 rounded-lg p-3 w-full text-center text-xl font-bold focus:outline-none focus:border-indigo-500"
                                    placeholder="Type word..."
                                    autoComplete="off"
                                />
                                <button type="submit" className="bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700">Go</button>
                            </form>
                        )}
                      </div>
                  )}

                  {/* é¸é …å€ (Battle & Fill) */}
                  {!showExplanation && gameState !== 'playing_typing' && (
                    <div className={`grid ${gameState === 'playing_fill' ? 'grid-cols-2 sm:grid-cols-4' : 'grid-cols-1'} gap-3`}>
                      {gameState === 'playing_battle' && (
                          currentOptions.map((option, idx) => (
                            <button
                              key={idx}
                              onClick={() => handleAnswer(option)}
                              disabled={feedback !== null}
                              className={`
                                p-4 rounded-xl font-bold text-lg transition-all transform active:scale-95
                                ${selectedOption === option 
                                  ? (feedback === 'correct' ? 'bg-green-500 text-white shadow-green-200' : 'bg-red-500 text-white shadow-red-200')
                                  : 'bg-slate-50 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600 border border-slate-200'
                                }
                                ${feedback !== null && option === currentQ.meaning && feedback === 'wrong' ? 'ring-2 ring-green-500 bg-green-50' : ''}
                              `}
                            >
                              {option}
                            </button>
                          ))
                      )}
                      
                      {gameState === 'playing_fill' && (
                          currentFillQuestion && currentFillQuestion.fillOptions.map((option, idx) => (
                            <button
                                key={idx}
                                onClick={() => handleAnswer(option)}
                                disabled={feedback !== null}
                                className={`
                                    p-4 rounded-xl font-bold text-2xl font-mono transition-all transform active:scale-95
                                    ${selectedOption === option
                                    ? (feedback === 'correct' ? 'bg-green-500 text-white' : 'bg-red-500 text-white')
                                    : 'bg-slate-100 text-slate-800 hover:bg-orange-100 hover:text-orange-600 border-2 border-slate-200'
                                    }
                                    ${feedback !== null && option === currentFillQuestion.targetChar && feedback === 'wrong' ? 'ring-4 ring-green-400 border-green-400' : ''}
                                `}
                            >
                                {option}
                            </button>
                          ))
                      )}
                    </div>
                  )}

                  {/* éŒ¯èª¤/æ­£ç¢ºé¡¯ç¤ºå€ */}
                  {showExplanation && (
                    <div className="bg-red-50 rounded-xl p-5 border border-red-100 animate-fadeIn">
                      <div className="flex items-center gap-2 text-red-600 font-bold mb-2">
                        <AlertCircle className="w-5 h-5" />
                        <span>Oops! æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š</span>
                      </div>
                      <p className="text-xl font-bold text-slate-800 mb-4">
                          {gameState === 'playing_battle' ? currentQ.meaning : (
                              gameState === 'playing_typing' ? (
                                  <span className="text-2xl font-mono">{currentTypingQuestion.word}</span>
                              ) : (
                                  <span>
                                    <span className="text-red-500">{currentFillQuestion.targetChar}</span> 
                                    <span className="text-slate-400 ml-2">({currentQ.word})</span>
                                  </span>
                              )
                          )}
                      </p>
                      
                      <button 
                        onClick={() => {
                           if (playerHp <= 0) {
                                setGameState('gameover');
                           } else {
                               nextQuestion();
                           }
                        }}
                        className="mt-4 w-full bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-900"
                      >
                        ç¹¼çºŒæˆ°é¬¥
                      </button>
                    </div>
                  )}
                  
                  {feedback === 'correct' && gameState !== 'playing_typing' && (
                     <div className="mt-4 bg-green-50 p-4 rounded-lg border border-green-100 text-left animate-fadeIn">
                        <div className="flex items-center gap-2 mb-2">
                            <BookOpen className="w-4 h-4 text-green-600" />
                            <span className="text-xs font-bold text-green-600 uppercase">Correct!</span>
                        </div>
                        <p className="text-slate-700 italic">"{currentQ.word}" means {currentQ.meaning}</p>
                     </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
