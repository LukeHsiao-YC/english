<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>英語單字大冒險 | English Vocab Adventure</title>
    <meta name="description" content="國小英語單字練習：單字卡、測驗與拼字遊戲">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', 'Fredoka', sans-serif;
            background-color: #f0fdf4;
            background-image: radial-gradient(#dcfce7 2px, transparent 2px);
            background-size: 24px 24px;
            overscroll-behavior-y: none;
        }

        .card-perspective {
            perspective: 1000px;
        }

        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
            width: 100%;
            height: 100%;
        }

        .card-flipped {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-bounce-custom {
            animation: bounce 0.5s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        /* Hide scrollbar for category list */
        .hide-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .hide-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">

    <div id="app" class="max-w-2xl mx-auto p-4 flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-white p-4 rounded-2xl shadow-lg border-b-4 border-green-200 mb-6 flex justify-between items-center animate-pop">
            <div class="flex items-center gap-3">
                <div class="bg-yellow-400 p-2 rounded-full text-white shadow-sm">
                    <i class="fas fa-star text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-gray-800 tracking-wide">英語單字大冒險</h1>
                    <p class="text-xs text-gray-500 font-medium">Spelling Bee & 300 Words</p>
                </div>
            </div>
            <button id="homeBtn" class="hidden bg-gray-100 hover:bg-gray-200 text-gray-600 px-4 py-2 rounded-xl transition-all font-bold text-sm">
                <i class="fas fa-home mr-2"></i>首頁
            </button>
        </header>

        <!-- Main Content Area -->
        <main id="mainContent" class="flex-1 relative">
            <!-- Content will be injected here by JavaScript -->
        </main>

        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-400 text-xs py-4">
            <p>© 2024 English Vocab Adventure. Based on 楊梅國小 Spelling Bee List.</p>
        </footer>
    </div>

    <script>
        // === Data Source ===
        const vocabData = [
            // === Lv1 (Grade 3) ===
            { id: 1, en: "one", zh: "一", category: "數字與基礎", level: "Lv1" },
            { id: 2, en: "two", zh: "二", category: "數字與基礎", level: "Lv1" },
            { id: 3, en: "three", zh: "三", category: "數字與基礎", level: "Lv1" },
            { id: 4, en: "four", zh: "四", category: "數字與基礎", level: "Lv1" },
            { id: 5, en: "five", zh: "五", category: "數字與基礎", level: "Lv1" },
            { id: 6, en: "six", zh: "六", category: "數字與基礎", level: "Lv1" },
            { id: 7, en: "seven", zh: "七", category: "數字與基礎", level: "Lv1" },
            { id: 8, en: "eight", zh: "八", category: "數字與基礎", level: "Lv1" },
            { id: 9, en: "nine", zh: "九", category: "數字與基礎", level: "Lv1" },
            { id: 10, en: "ten", zh: "十", category: "數字與基礎", level: "Lv1" },
            { id: 11, en: "book", zh: "書", category: "學校用品", level: "Lv1" },
            { id: 12, en: "bag", zh: "袋子、包包", category: "學校用品", level: "Lv1" },
            { id: 13, en: "box", zh: "箱子", category: "學校用品", level: "Lv1" },
            { id: 14, en: "desk", zh: "書桌", category: "學校用品", level: "Lv1" },
            { id: 15, en: "ruler", zh: "尺", category: "學校用品", level: "Lv1" },
            { id: 16, en: "pencil", zh: "鉛筆", category: "學校用品", level: "Lv1" },
            { id: 17, en: "eraser", zh: "橡皮擦", category: "學校用品", level: "Lv1" },
            { id: 19, en: "pen", zh: "原子筆", category: "學校用品", level: "Lv1" },
            { id: 20, en: "red", zh: "紅色的", category: "顏色", level: "Lv1" },
            { id: 21, en: "blue", zh: "藍色的", category: "顏色", level: "Lv1" },
            { id: 22, en: "green", zh: "綠色的", category: "顏色", level: "Lv1" },
            { id: 23, en: "black", zh: "黑色的", category: "顏色", level: "Lv1" },
            { id: 24, en: "white", zh: "白色的", category: "顏色", level: "Lv1" },
            { id: 28, en: "apple", zh: "蘋果", category: "食物", level: "Lv1" },
            { id: 29, en: "egg", zh: "雞蛋", category: "食物", level: "Lv1" },
            { id: 30, en: "cake", zh: "蛋糕", category: "食物", level: "Lv1" },
            { id: 31, en: "milk", zh: "牛奶", category: "食物", level: "Lv1" },
            { id: 33, en: "eye", zh: "眼睛", category: "身體部位", level: "Lv1" },
            { id: 34, en: "ear", zh: "耳朵", category: "身體部位", level: "Lv1" },
            { id: 36, en: "hand", zh: "手", category: "身體部位", level: "Lv1" },
            { id: 37, en: "nose", zh: "鼻子", category: "身體部位", level: "Lv1" },
            { id: 40, en: "bus", zh: "公車", category: "交通", level: "Lv1" },
            { id: 41, en: "big", zh: "大的", category: "形容詞", level: "Lv1" },
            { id: 42, en: "small", zh: "小的", category: "形容詞", level: "Lv1" },
            { id: 50, en: "happy", zh: "快樂的", category: "形容詞", level: "Lv1" },
            { id: 54, en: "ant", zh: "螞蟻", category: "動物", level: "Lv1" },
            { id: 55, en: "cat", zh: "貓", category: "動物", level: "Lv1" },
            { id: 56, en: "dog", zh: "狗", category: "動物", level: "Lv1" },
            { id: 57, en: "pig", zh: "豬", category: "動物", level: "Lv1" },
            { id: 58, en: "fish", zh: "魚", category: "動物", level: "Lv1" },
            { id: 60, en: "bird", zh: "鳥", category: "動物", level: "Lv1" },
            { id: 62, en: "zoo", zh: "動物園", category: "場所", level: "Lv1" },
            { id: 67, en: "father", zh: "父親", category: "家庭", level: "Lv1" },
            { id: 68, en: "mother", zh: "母親", category: "家庭", level: "Lv1" },
            { id: 74, en: "teacher", zh: "老師", category: "人物", level: "Lv1" },
            { id: 75, en: "student", zh: "學生", category: "人物", level: "Lv1" },
            { id: 78, en: "car", zh: "汽車", category: "交通", level: "Lv1" },
            { id: 80, en: "home", zh: "家", category: "場所", level: "Lv1" },
            // === Lv2 (Grade 4) ===
            { id: 91, en: "juice", zh: "果汁", category: "食物", level: "Lv2" },
            { id: 92, en: "pizza", zh: "比薩", category: "食物", level: "Lv2" },
            { id: 93, en: "water", zh: "水", category: "食物", level: "Lv2" },
            { id: 94, en: "school", zh: "學校", category: "場所", level: "Lv2" },
            { id: 95, en: "park", zh: "公園", category: "場所", level: "Lv2" },
            { id: 99, en: "sing", zh: "唱歌", category: "動作", level: "Lv2" },
            { id: 100, en: "read", zh: "閱讀", category: "動作", level: "Lv2" },
            { id: 101, en: "draw", zh: "畫畫", category: "動作", level: "Lv2" },
            { id: 104, en: "run", zh: "跑", category: "動作", level: "Lv2" },
            { id: 111, en: "thirty", zh: "三十", category: "數字與基礎", level: "Lv2" },
            { id: 118, en: "hundred", zh: "一百", category: "數字與基礎", level: "Lv2" },
            { id: 124, en: "swim", zh: "游泳", category: "動作", level: "Lv2" },
            { id: 125, en: "walk", zh: "走路", category: "動作", level: "Lv2" },
            { id: 130, en: "write", zh: "寫", category: "動作", level: "Lv2" },
            { id: 131, en: "dance", zh: "跳舞", category: "動作", level: "Lv2" },
            { id: 134, en: "kitchen", zh: "廚房", category: "場所", level: "Lv2" },
            { id: 138, en: "yellow", zh: "黃色的", category: "顏色", level: "Lv2" },
            { id: 140, en: "purple", zh: "紫色的", category: "顏色", level: "Lv2" },
            // === Lv3 (Grade 5) ===
            { id: 141, en: "sunny", zh: "晴朗的", category: "天氣", level: "Lv3" },
            { id: 142, en: "cloudy", zh: "多雲的", category: "天氣", level: "Lv3" },
            { id: 144, en: "rainy", zh: "下雨的", category: "天氣", level: "Lv3" },
            { id: 146, en: "hungry", zh: "飢餓的", category: "形容詞", level: "Lv3" },
            { id: 148, en: "angry", zh: "生氣的", category: "形容詞", level: "Lv3" },
            { id: 150, en: "hamburger", zh: "漢堡", category: "食物", level: "Lv3" },
            { id: 151, en: "ice cream", zh: "冰淇淋", category: "食物", level: "Lv3" },
            { id: 153, en: "sandwich", zh: "三明治", category: "食物", level: "Lv3" },
            { id: 154, en: "morning", zh: "早晨", category: "時間", level: "Lv3" },
            { id: 158, en: "today", zh: "今天", category: "時間", level: "Lv3" },
            { id: 162, en: "math", zh: "數學", category: "學校用品", level: "Lv3" },
            { id: 164, en: "English", zh: "英文", category: "學校用品", level: "Lv3" },
            { id: 166, en: "music", zh: "音樂", category: "學校用品", level: "Lv3" },
            { id: 168, en: "frog", zh: "青蛙", category: "動物", level: "Lv3" },
            { id: 171, en: "zebra", zh: "斑馬", category: "動物", level: "Lv3" },
            { id: 172, en: "rabbit", zh: "兔子", category: "動物", level: "Lv3" },
            { id: 175, en: "elephant", zh: "大象", category: "動物", level: "Lv3" },
            { id: 176, en: "tiger", zh: "老虎", category: "動物", level: "Lv3" },
            { id: 177, en: "head", zh: "頭", category: "身體部位", level: "Lv3" },
            { id: 179, en: "hair", zh: "頭髮", category: "身體部位", level: "Lv3" },
            // === Lv4 (Grade 6) ===
            { id: 181, en: "Taiwan", zh: "台灣", category: "地點", level: "Lv4" },
            { id: 184, en: "the USA", zh: "美國", category: "地點", level: "Lv4" },
            { id: 187, en: "plane", zh: "飛機", category: "交通", level: "Lv4" },
            { id: 188, en: "bike", zh: "腳踏車", category: "交通", level: "Lv4" },
            { id: 189, en: "taxi", zh: "計程車", category: "交通", level: "Lv4" },
            { id: 190, en: "train", zh: "火車", category: "交通", level: "Lv4" },
            { id: 203, en: "breakfast", zh: "早餐", category: "食物", level: "Lv4" },
            { id: 204, en: "lunch", zh: "午餐", category: "食物", level: "Lv4" },
            { id: 205, en: "dinner", zh: "晚餐", category: "食物", level: "Lv4" },
            { id: 206, en: "computer", zh: "電腦", category: "學校用品", level: "Lv4" },
            { id: 212, en: "spring", zh: "春天", category: "季節", level: "Lv4" },
            { id: 213, en: "summer", zh: "夏天", category: "季節", level: "Lv4" },
            { id: 214, en: "fall", zh: "秋天", category: "季節", level: "Lv4" },
            { id: 215, en: "winter", zh: "冬天", category: "季節", level: "Lv4" },
            { id: 218, en: "beautiful", zh: "美麗的", category: "形容詞", level: "Lv4" },
            { id: 222, en: "shoes", zh: "鞋子", category: "衣物", level: "Lv4" },
            { id: 223, en: "dress", zh: "洋裝", category: "衣物", level: "Lv4" },
            { id: 227, en: "T-shirt", zh: "T恤", category: "衣物", level: "Lv4" },
            { id: 232, en: "classroom", zh: "教室", category: "場所", level: "Lv4" },
            { id: 234, en: "library", zh: "圖書館", category: "場所", level: "Lv4" },
            { id: 235, en: "supermarket", zh: "超級市場", category: "場所", level: "Lv4" }
        ];

        // === State Management ===
        let state = {
            mode: 'menu',
            category: 'All',
            filteredWords: [],
            currentIndex: 0,
            score: 0,
            isFlipped: false,
            quizOptions: [],
            quizSelected: null
        };

        // === Logic ===
        const categories = ['All', ...new Set(vocabData.map(item => item.category))];

        function init() {
            filterWords();
            render();
            
            // Event Listeners
            document.getElementById('homeBtn').addEventListener('click', () => {
                state.mode = 'menu';
                render();
            });
        }

        function filterWords() {
            if (state.category === 'All') {
                state.filteredWords = [...vocabData];
            } else {
                state.filteredWords = vocabData.filter(item => item.category === state.category);
            }
        }

        function startMode(mode) {
            // Shuffle
            state.filteredWords.sort(() => Math.random() - 0.5);
            state.mode = mode;
            state.currentIndex = 0;
            state.score = 0;
            state.isFlipped = false;
            state.quizSelected = null;
            
            if (mode === 'quiz') generateQuizOptions();
            
            render();
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }

        // === Quiz Logic ===
        function generateQuizOptions() {
            const current = state.filteredWords[state.currentIndex];
            const others = vocabData.filter(w => w.id !== current.id);
            const wrong = others.sort(() => 0.5 - Math.random()).slice(0, 3);
            state.quizOptions = [current, ...wrong].sort(() => 0.5 - Math.random());
            state.quizSelected = null;
        }

        function handleQuizSelect(optionId) {
            if (state.quizSelected) return; // Prevent double click
            
            state.quizSelected = optionId;
            const current = state.filteredWords[state.currentIndex];
            
            if (optionId === current.id) {
                state.score++;
                speak(current.en);
            }
            
            renderQuiz(); // Re-render to show colors

            // Auto next
            setTimeout(() => {
                if (state.currentIndex + 1 < Math.min(10, state.filteredWords.length)) {
                    state.currentIndex++;
                    generateQuizOptions();
                } else {
                    state.mode = 'result';
                }
                render();
            }, 1200);
        }

        // === Rendering ===
        function render() {
            const main = document.getElementById('mainContent');
            const homeBtn = document.getElementById('homeBtn');
            
            homeBtn.classList.toggle('hidden', state.mode === 'menu');

            if (state.mode === 'menu') {
                renderMenu(main);
            } else if (state.mode === 'flashcard') {
                renderFlashcards(main);
            } else if (state.mode === 'quiz') {
                renderQuiz(main);
            } else if (state.mode === 'spelling') {
                renderSpelling(main);
            } else if (state.mode === 'result') {
                renderResult(main);
            }
        }

        function renderMenu(container) {
            let catHTML = categories.map(cat => `
                <button onclick="setCategory('${cat}')" 
                    class="px-4 py-2 rounded-full text-sm font-bold transition-all transform hover:scale-105 ${state.category === cat ? 'bg-blue-500 text-white shadow-md ring-2 ring-blue-200' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                    ${cat}
                </button>
            `).join('');

            container.innerHTML = `
                <div class="space-y-6 animate-pop">
                    <div class="bg-white p-6 rounded-3xl shadow-xl border border-blue-50">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-bold text-gray-700 flex items-center">
                                <i class="fas fa-filter text-blue-400 mr-2"></i> 選擇主題
                            </h2>
                            <button onclick="speak('Welcome')" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-3 py-1 rounded-full">
                                <i class="fas fa-volume-up mr-1"></i> 測試語音
                            </button>
                        </div>
                        <div class="flex flex-wrap gap-2 max-h-40 overflow-y-auto hide-scrollbar">
                            ${catHTML}
                        </div>
                        <p class="mt-4 text-sm text-gray-500 text-right border-t pt-3">
                            包含 <span class="text-blue-600 font-bold">${state.filteredWords.length}</span> 個單字
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${renderGameCard('單字卡學習', '翻卡片，聽發音，輕鬆記', 'fa-book-open', 'from-green-400 to-green-600', 'shadow-green-200', 'flashcard')}
                        ${renderGameCard('單字測驗', '四選一，挑戰反應力', 'fa-question-circle', 'from-yellow-400 to-yellow-600', 'shadow-yellow-200', 'quiz')}
                        ${renderGameCard('拼字大師', '看中文拼英文，備戰比賽', 'fa-keyboard', 'from-purple-400 to-purple-600', 'shadow-purple-200', 'spelling')}
                    </div>
                </div>
            `;
        }

        function renderGameCard(title, desc, icon, color, shadow, mode) {
            return `
            <button onclick="startMode('${mode}')" class="w-full text-left p-6 rounded-3xl text-white shadow-xl transition-all transform hover:scale-105 hover:-translate-y-1 bg-gradient-to-br ${color} ${shadow} relative overflow-hidden group">
                <div class="relative z-10">
                    <i class="fas ${icon} text-3xl mb-3 opacity-90"></i>
                    <h3 class="text-xl font-bold mb-1">${title}</h3>
                    <p class="text-white/90 text-sm font-medium">${desc}</p>
                </div>
                <div class="absolute -right-4 -bottom-4 opacity-20 transform rotate-12 group-hover:scale-110 transition-transform">
                    <i class="fas ${icon} text-8xl"></i>
                </div>
            </button>`;
        }

        function renderFlashcards(container) {
            const word = state.filteredWords[state.currentIndex];
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full animate-pop">
                    <div class="w-full max-w-md card-perspective h-80 cursor-pointer group" onclick="toggleFlip()">
                        <div class="card-inner relative transition-all duration-500 ${state.isFlipped ? 'card-flipped' : ''}">
                            <!-- Front -->
                            <div class="card-front bg-white rounded-3xl shadow-2xl flex flex-col items-center justify-center border-b-8 border-blue-200">
                                <span class="text-sm bg-blue-100 text-blue-600 px-3 py-1 rounded-full mb-6 font-bold uppercase tracking-wider">${word.category}</span>
                                <h2 class="text-5xl font-bold text-gray-800 mb-4 text-center">${word.en}</h2>
                                <div onclick="event.stopPropagation(); speak('${word.en}')" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-transform hover:scale-110 active:scale-95">
                                    <i class="fas fa-volume-up text-xl"></i>
                                </div>
                                <p class="absolute bottom-6 text-gray-400 text-sm animate-pulse">點擊翻卡</p>
                            </div>
                            <!-- Back -->
                            <div class="card-back bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl shadow-2xl flex flex-col items-center justify-center border-b-8 border-indigo-800 text-white">
                                <h2 class="text-5xl font-bold mb-4">${word.zh}</h2>
                                <p class="opacity-80 mt-2 bg-white/20 px-3 py-1 rounded-full text-sm">${word.level}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-6 mt-8 w-full max-w-md justify-between px-4">
                        <button onclick="changeCard(-1)" class="bg-white hover:bg-gray-50 text-gray-700 w-14 h-14 rounded-2xl shadow-lg border-b-4 border-gray-200 flex items-center justify-center transition-transform active:scale-95">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div class="font-bold text-gray-500 text-lg bg-white px-6 py-3 rounded-xl shadow-sm border border-gray-100">
                            ${state.currentIndex + 1} / ${state.filteredWords.length}
                        </div>
                        <button onclick="changeCard(1)" class="bg-white hover:bg-gray-50 text-gray-700 w-14 h-14 rounded-2xl shadow-lg border-b-4 border-gray-200 flex items-center justify-center transition-transform active:scale-95">
                            <i class="fas fa-arrow-right text-xl"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderQuiz(container) {
            const word = state.filteredWords[state.currentIndex];
            let optionsHTML = state.quizOptions.map(opt => {
                let btnClass = "bg-white text-gray-700 hover:bg-gray-50 border-gray-200";
                if (state.quizSelected) {
                    if (opt.id === word.id) btnClass = "bg-green-500 text-white border-green-600";
                    else if (opt.id === state.quizSelected) btnClass = "bg-red-500 text-white border-red-600";
                    else btnClass = "bg-gray-100 text-gray-400 border-gray-100 opacity-50";
                }
                return `<button onclick="handleQuizSelect(${opt.id})" ${state.quizSelected ? 'disabled' : ''} 
                    class="p-4 rounded-xl text-lg font-bold shadow-sm border-b-4 transition-all transform active:scale-95 ${btnClass}">
                    ${opt.zh}
                </button>`;
            }).join('');

            container.innerHTML = `
                <div class="max-w-md mx-auto animate-pop">
                    <div class="flex justify-between items-center mb-6 px-2">
                        <span class="font-bold text-blue-500">題目 ${state.currentIndex + 1} / ${Math.min(10, state.filteredWords.length)}</span>
                        <span class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-sm font-bold shadow-sm">得分: ${state.score * 10}</span>
                    </div>
                    <div class="bg-white p-8 rounded-3xl shadow-xl border-b-8 border-gray-100 mb-6 text-center">
                        <h3 class="text-gray-400 text-sm font-bold uppercase tracking-wider mb-2">中文意思是什麼？</h3>
                        <h2 class="text-4xl font-bold text-gray-800">${word.en}</h2>
                        <button onclick="speak('${word.en}')" class="mt-2 text-blue-400 hover:text-blue-600"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="grid grid-cols-1 gap-3">${optionsHTML}</div>
                </div>
            `;
        }

        function renderSpelling(container) {
            const word = state.filteredWords[state.currentIndex];
            // If already rendered, we might need to preserve input, but for simplicity re-render is fine
            // We'll attach the event listener after HTML injection
            container.innerHTML = `
                <div class="max-w-md mx-auto bg-white p-8 rounded-3xl shadow-2xl border-b-8 border-purple-100 animate-pop">
                    <div class="text-center mb-8">
                        <span class="inline-block bg-purple-100 text-purple-600 px-3 py-1 rounded-full text-xs font-bold mb-4">${word.category}</span>
                        <h2 class="text-4xl font-bold text-gray-800 mb-2">${word.zh}</h2>
                        <button onclick="speak('${word.en}')" class="text-gray-300 hover:text-purple-500 transition-colors"><i class="fas fa-volume-up"></i> (聽發音)</button>
                    </div>
                    <form onsubmit="handleSpelling(event)" class="space-y-4">
                        <div class="relative">
                            <input id="spellingInput" type="text" class="w-full text-center text-3xl font-bold p-4 rounded-xl border-4 border-gray-200 outline-none focus:border-purple-400 transition-colors" placeholder="輸入英文..." autocomplete="off" autofocus>
                            <div id="checkIcon" class="hidden absolute right-4 top-4 text-green-500 text-2xl animate-bounce-custom"><i class="fas fa-check-circle"></i></div>
                        </div>
                        <div id="hintText" class="text-center text-xl font-mono tracking-widest text-purple-500 font-bold hidden"></div>
                        <div class="grid grid-cols-2 gap-3 pt-4">
                            <button type="button" onclick="showSpellingHint()" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 py-3 rounded-xl font-bold transition-colors"><i class="fas fa-lightbulb mr-2"></i> 提示</button>
                            <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-purple-200 transition-transform active:scale-95">送出 <i class="fas fa-paper-plane ml-2"></i></button>
                        </div>
                    </form>
                    <div class="mt-6 text-center text-gray-300 text-sm">Question ${state.currentIndex + 1}</div>
                </div>
            `;
            setTimeout(() => document.getElementById('spellingInput')?.focus(), 50);
        }

        function renderResult(container) {
            container.innerHTML = `
                <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-md mx-auto animate-pop border-b-8 border-yellow-100">
                    <div class="w-24 h-24 bg-yellow-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg animate-bounce-custom">
                        <i class="fas fa-trophy text-4xl text-white"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">測驗完成！</h2>
                    <p class="text-gray-500 mb-6">你真棒！繼續加油！</p>
                    <div class="text-6xl font-black text-blue-500 mb-8">${state.score * 10}<span class="text-2xl text-gray-400">分</span></div>
                    <button onclick="startMode('${state.mode === 'result' ? 'menu' : state.mode}')" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-200 transition-transform hover:-translate-y-1 w-full">
                        回首頁
                    </button>
                </div>
            `;
        }

        // === Interactions ===
        function setCategory(cat) {
            state.category = cat;
            filterWords();
            render();
        }

        function toggleFlip() {
            state.isFlipped = !state.isFlipped;
            renderFlashcards(document.getElementById('mainContent'));
        }

        function changeCard(dir) {
            state.isFlipped = false;
            // Delay to allow flip back animation if needed, but instant is snappier
            const len = state.filteredWords.length;
            state.currentIndex = (state.currentIndex + dir + len) % len;
            renderFlashcards(document.getElementById('mainContent'));
        }

        function handleSpelling(e) {
            e.preventDefault();
            const input = document.getElementById('spellingInput');
            const icon = document.getElementById('checkIcon');
            const word = state.filteredWords[state.currentIndex];
            
            if (input.value.trim().toLowerCase() === word.en.toLowerCase()) {
                input.classList.remove('border-gray-200', 'focus:border-purple-400', 'border-red-400', 'bg-red-50');
                input.classList.add('border-green-400', 'bg-green-50', 'text-green-600');
                icon.classList.remove('hidden');
                speak(word.en);
                
                setTimeout(() => {
                    state.currentIndex = (state.currentIndex + 1) % state.filteredWords.length;
                    renderSpelling(document.getElementById('mainContent'));
                }, 1500);
            } else {
                input.classList.add('border-red-400', 'bg-red-50', 'text-red-600');
                input.classList.add('animate-pulse');
                setTimeout(() => input.classList.remove('animate-pulse'), 500);
            }
        }

        function showSpellingHint() {
            const word = state.filteredWords[state.currentIndex];
            const len = word.en.length;
            const visible = Math.ceil(len / 2);
            let hint = "";
            for(let i=0; i<len; i++) {
                hint += (i < visible) ? word.en[i] : "_";
            }
            const hintEl = document.getElementById('hintText');
            hintEl.textContent = hint;
            hintEl.classList.remove('hidden');
            hintEl.classList.add('animate-pulse');
        }

        // Start
        init();
    </script>
</body>
</html>